<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØºØ±ÙØ© Ø¯Ø±Ø¯Ø´Ø© Ø®Ø§ØµØ© ğŸŒ¸</title>
<style>
body{
  font-family:'Arial', sans-serif;
  background: linear-gradient(135deg, #f6d365, #fda085);
  margin:0; padding:0;
  direction:rtl;
  text-align:right;
}

#loginBox{
  margin:50px auto;
  background:#ffd1e8;
  width:320px;
  padding:20px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  text-align:center;
}

#chatBox{
  display:none;
  margin:20px auto;
  width:90%;
  max-width:600px;
}

#messages{
  height:400px;
  overflow-y:auto;
  background:#ffe0f7;
  padding:15px;
  border-radius:15px;
  margin-bottom:10px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

.message{
  padding:8px 12px;
  border-radius:12px;
  margin:5px 0;
  max-width:70%;
  word-wrap:break-word;
  clear:both;
}

.message.left{ float:left; }
.message.right{ float:right; color:white; }

.message .time{
  display:block;
  font-size:12px;
  margin-top:5px;
  color:#555;
}

input{
  padding:10px;
  margin:5px;
  width:65%;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  padding:10px 15px;
  border:none;
  background:#ff4d6d;
  color:white;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="loginBox">
  <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©</h2>
  <input type="text" id="username" placeholder="Ø§Ø³Ù…Ùƒ">
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="chatBox">
  <h3>ğŸ’¬ ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h3>
  <div id="messages"></div>
  <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
  <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAXGS8i2-fHN8H9FE2jylKlOF9j3sgYxDA",
  authDomain: "star-8444d.firebaseapp.com",
  projectId: "star-8444d",
  storageBucket: "star-8444d.firebasestorage.app",
  messagingSenderId: "386147064751",
  appId: "1:386147064751:web:411113abc86a47e65eed5a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let myUsername = "";

// Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
const colors = {};
function getColor(name){
  if(!colors[name]){
    colors[name] = '#' + Math.floor(Math.random()*16777215).toString(16);
  }
  return colors[name];
}

// Ù„Ùˆ Ø§Ù„Ø§Ø³Ù… Ù…Ø®Ø²Ù† Ù…Ø³Ø¨Ù‚Ù‹Ø§
window.onload = function(){
  const savedName = localStorage.getItem("myUsername");
  if(savedName){
    document.getElementById("username").value = savedName;
  }
}

window.checkPassword = function(){
  let username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;

  if(username===""){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ"); return; }

  if(password === "1234"){
    myUsername = username;
    localStorage.setItem("myUsername", username);
    document.getElementById("loginBox").style.display="none";
    document.getElementById("chatBox").style.display="block";
  }else{
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·");
  }
}

window.sendMessage = async function(){
  const msg = document.getElementById("msgInput").value;
  if(!msg.trim()) return;

  await addDoc(collection(db,"messages"),{
    text: msg,
    username: myUsername,
    time: Date.now()
  });
  document.getElementById("msgInput").value="";
}

const q = query(collection(db,"messages"), orderBy("time"));

onSnapshot(q, snapshot=>{
  const messagesDiv = document.getElementById("messages");
  messagesDiv.innerHTML = "";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className = "message " + (data.username===myUsername?"right":"left");
    div.style.background = data.username===myUsername? "#ff4d6d": getColor(data.username);
    const d = new Date(data.time);
    div.innerHTML = `<b>${data.username}</b>: ${data.text}<span class="time">${d.toLocaleDateString("ar-EG")} ${d.toLocaleTimeString("ar-EG")}</span>`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
});
</script>

</body>
</html>
